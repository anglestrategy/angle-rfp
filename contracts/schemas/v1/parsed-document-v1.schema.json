{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://angle-rfp.dev/schemas/v1/parsed-document-v1.schema.json",
  "title": "ParsedDocumentV1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "analysisId",
    "detectedFormat",
    "primaryLanguage",
    "rawText",
    "sections",
    "tables",
    "evidenceMap",
    "parseConfidence"
  ],
  "properties": {
    "schemaVersion": { "type": "string", "const": "1.0.0" },
    "analysisId": { "type": "string", "format": "uuid" },
    "detectedFormat": {
      "type": "string",
      "enum": ["pdf", "docx", "txt"]
    },
    "primaryLanguage": {
      "type": "string",
      "enum": ["arabic", "english", "mixed"]
    },
    "rawText": { "type": "string", "minLength": 1 },
    "sections": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "startOffset", "endOffset"],
        "properties": {
          "name": { "type": "string" },
          "startOffset": { "type": "integer", "minimum": 0 },
          "endOffset": { "type": "integer", "minimum": 0 }
        }
      }
    },
    "tables": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["title", "headers", "rows", "pages", "confidence"],
        "properties": {
          "title": { "type": "string" },
          "headers": { "type": "array", "items": { "type": "string" } },
          "rows": {
            "type": "array",
            "items": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "pages": { "type": "array", "items": { "type": "integer", "minimum": 1 } },
          "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
        }
      }
    },
    "evidenceMap": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["page", "charStart", "charEnd", "excerpt", "sourceType"],
        "properties": {
          "page": { "type": "integer", "minimum": 1 },
          "charStart": { "type": "integer", "minimum": 0 },
          "charEnd": { "type": "integer", "minimum": 0 },
          "excerpt": { "type": "string" },
          "sourceType": {
            "type": "string",
            "enum": ["pdf_text", "ocr", "docx", "txt", "table_cell"]
          }
        }
      }
    },
    "parseConfidence": { "type": "number", "minimum": 0, "maximum": 1 },
    "warnings": {
      "type": "array",
      "items": { "type": "string" }
    },
    "ocrStats": {
      "oneOf": [
        { "type": "null" },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["used", "pagesOcred"],
          "properties": {
            "used": { "type": "boolean" },
            "pagesOcred": { "type": "integer", "minimum": 0 }
          }
        }
      ]
    }
  }
}
